(function(a,b){(function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++){if(b in this&&this[b]===a)return b}return-1};p=a.document;d="before";c="after";k="readyState";j="addEventListener";i="removeEventListener";g="dispatchEvent";n="XMLHttpRequest";h="FormData";l=["load","loadend","loadstart"];e=["progress","abort","error","timeout"];(v=Array.prototype).indexOf||(v.indexOf=function(a){var b,c,d,e;for(b=d=0,e=this.length;d<e;b=++d){c=this[b];if(c===a){return b}}return-1});t=function(a,b){return Array.prototype.slice.call(a,b)};r=function(a,b){var c,d;for(c in a){d=a[c];if(c==="returnValue"){continue}try{b[c]=a[c]}catch(e){}}return b};s=function(a,b,c){var d,e,f,h;e=function(a){return function(d){var e,f,h;e={};for(f in d){if(f==="returnValue"){continue}h=d[f];e[f]=h===b?c:h}e;return c[g](a,e)}};for(f=0,h=a.length;f<h;f++){d=a[f];b["on"+d]=e(d)}};q=function(a){var b;if(p.createEventObject!=null){b=p.createEventObject();b.type=a;return b}else{try{return new Event(a)}catch(c){return{type:a}}}};f=function(a){var c,d,e;d={};e=function(a){return d[a]||[]};c={};c[j]=function(a,c,f){d[a]=e(a);if(d[a].indexOf(c)>=0){return}f=f===b?d[a].length:f;d[a].splice(f,0,c)};c[i]=function(a,b){var c;c=e(a).indexOf(b);if(c===-1){return}e(a).splice(c,1)};c[g]=function(){var d,f,g,h,i,j,k,l;d=t(arguments);f=d.shift();if(!a){d[0]=r(d[0],q(f))}h=c["on"+f];if(h){h.apply(b,d)}l=e(f).concat(e("*"));for(g=j=0,k=l.length;j<k;g=++j){i=l[g];i.apply(b,d)}};if(a){c.listeners=function(a){return t(e(a))};c.on=c[j];c.off=c[i];c.fire=c[g];c.once=function(a,b){var d;d=function(){c.off(a,d);return b.apply(null,arguments)};return c.on(a,d)};c.destroy=function(){return d={}}}return c};u=f(true);u.EventEmitter=f;u[d]=function(a,b){if(a.length<1||a.length>2){throw"invalid hook"}return u[j](d,a,b)};u[c]=function(a,b){if(a.length<2||a.length>3){throw"invalid hook"}return u[j](c,a,b)};u.enable=function(){a[n]=m};u.disable=function(){a[n]=u[n]};o=u.headers=function(a,b){var c,d,e,f,g,h,i,j,k;if(b==null){b={}}switch(typeof a){case"object":d=[];for(e in a){g=a[e];f=e.toLowerCase();d.push(""+f+":	"+g)}return d.join("\n");case"string":d=a.split("\n");for(i=0,j=d.length;i<j;i++){c=d[i];if(/([^:]+):\s*(.+)/.test(c)){f=(k=RegExp.$1)!=null?k.toLowerCase():void 0;h=RegExp.$2;if(b[f]==null){b[f]=h}}}return b}};if(u[h]=a[h]){a[h]=function(a){var b,c=this;this.fd=new u[h](a);this.form=a;b=[];Object.defineProperty(this,"entries",{get:function(){var c;c=!a?[]:t(a.querySelectorAll("input,select")).filter(function(a){var b;return(b=a.type)!=="checkbox"&&b!=="radio"||a.checked}).map(function(a){return[a.name,a.type==="file"?a.files:a.value]});return c.concat(b)}});this.append=function(){var a;a=t(arguments);b.push(a);return c.fd.append.apply(c.fd,a)}}}u[n]=a[n];m=a[n]=function(){var b,i,m,p,q,t,v,x,y,z,A,B,C,D,E;E=new u[n];q=false;B=false;y={};y.headers={};z={};z.headers={};x=function(){var a,b,c,d;z.status=E.status;z.statusText=E.statusText;d=o(E.getAllResponseHeaders());for(a in d){c=d[a];if(!z.headers[a]){b=a.toLowerCase();z.headers[b]=c}}};v=function(){try{z.text=E.responseText}catch(a){}try{z.xml=E.responseXML}catch(a){}z.data=E.response||z.text};D=function(){p.status=z.status;p.statusText=z.statusText};C=function(){if(z.hasOwnProperty("text")){p.responseText=z.text}if(z.hasOwnProperty("xml")){p.responseXML=z.xml}p.response=z.data||null};m=function(a){while(a>b&&b<4){p[k]=++b;if(b===1){p[g]("loadstart",{})}if(b===2){D()}if(b===4){D();C()}p[g]("readystatechange",{});if(b===4){setTimeout(i,0)}}};i=function(){if(!q){p[g]("load",{})}p[g]("loadend",{});if(q){p[k]=0}};b=0;A=function(a){var b,d;if(a!==4){m(a);return}b=u.listeners(c);d=function(){var a;if(!b.length){return m(4)}a=b.shift();if(a.length===2){a(y,z);return d()}else if(a.length===3&&y.async){return a(y,z,d)}else{return d()}};d()};p=y.xhr=f();E.onreadystatechange=function(a){try{if(E[k]===2){x()}}catch(b){}if(E[k]===4){B=false;x();v()}A(E[k])};t=function(){q=true};p[j]("error",t);p[j]("timeout",t);p[j]("abort",t);p[j]("progress",function(){if(b<3){A(3)}else{p[g]("readystatechange",{})}});s(e,E,p);if("withCredentials"in E||u.addWithCredentials){p.withCredentials=false}p.status=0;p.open=function(a,b,c,d,e){y.method=a;y.url=b;y.async=c!==false;y.user=d;y.pass=e;A(1)};p.send=function(b){var c,e,f,g,i,j,k,l;l=["type","timeout","withCredentials"];for(j=0,k=l.length;j<k;j++){e=l[j];f=e==="type"?"responseType":e;if(f in p){y[e]=p[f]}}y.body=b;i=function(){var b,c,d,g,i,j;B=true;E.open(y.method,y.url,y.async,y.user,y.pass);i=["type","timeout","withCredentials"];for(d=0,g=i.length;d<g;d++){e=i[d];f=e==="type"?"responseType":e;if(e in y){E[f]=y[e]}}j=y.headers;for(b in j){c=j[b];E.setRequestHeader(b,c)}if(a[h]&&y.body instanceof a[h]){y.body=y.body.fd}E.send(y.body)};c=u.listeners(d);g=function(){var a,b;if(!c.length){return i()}a=function(a){if(typeof a==="object"&&(typeof a.status==="number"||typeof z.status==="number")){r(a,z);if(w.call(a,"data")<0){a.data=a.response||a.text}A(4);return}g()};a.head=function(a){r(a,z);return A(2)};a.progress=function(a){r(a,z);return A(3)};b=c.shift();if(b.length===1){return a(b(y))}else if(b.length===2&&y.async){return b(y,a)}else{return a()}};g()};p.abort=function(){if(B){E.abort()}else{p[g]("abort",{})}};p.setRequestHeader=function(a,b){var c;c=a!=null?a.toLowerCase():void 0;y.headers[c]=b};p.getResponseHeader=function(a){var b;b=a!=null?a.toLowerCase():void 0;return z.headers[b]};p.getAllResponseHeaders=function(){return o(z.headers)};if(E.overrideMimeType){p.overrideMimeType=function(){return E.overrideMimeType.apply(E,arguments)}}if(E.upload){p.upload=y.upload=f();s(e.concat(l),E.upload,p.upload)}return p};if(typeof this.define==="function"&&this.define.amd){define("xhook",[],function(){return u})}else{(this.exports||this).xhook=u}}).call(this,a);var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;C=null;g=function(a){var b,c;if(C===null){C={};r()}for(b in a){c=a[b];x("adding slave: "+b);C[b]=c}};n={};o=function(a,b){var c;if(n[a]){return n[a]}c=l.createElement("iframe");c.id=c.name=p();x("creating iframe "+c.id);c.src=""+a+b;c.setAttribute("style","display:none;");l.body.appendChild(c);return n[a]=c.contentWindow};r=function(){var a,b,c;b=function(a,b){var c,d,e,f,g;e=a[0],f=a[1];c=t(f,"Blob");d=t(f,"File");if(!(c||d)){return 0}g=new FileReader;g.onload=function(){a[1]=null;if(d){a[2]=f.name}return b(["XD_BLOB",a,this.result,f.type])};g.readAsArrayBuffer(f);return 1};a=function(a,c){var d;a.forEach(function(b,c){var d,e,f,g,h;e=b[0],f=b[1];if(t(f,"FileList")){a.splice(c,1);for(g=0,h=f.length;g<h;g++){d=f[g];a.splice(c,0,[e,d])}}});d=0;a.forEach(function(e,f){d+=b(e,function(b){a[f]=b;if(--d===0){c()}})});if(d===0){c()}};c=function(b,c){var d,e,f;c.on("xhr-event",function(){return b.xhr.dispatchEvent.apply(null,arguments)});c.on("xhr-upload-event",function(){return b.xhr.upload.dispatchEvent.apply(null,arguments)});e=G(b);e.headers=b.headers;if(b.withCredentials){e.credentials=l.cookie}f=function(){return c.emit("request",e)};if(b.body){e.body=b.body;if(t(e.body,"FormData")){d=e.body.entries;e.body=["XD_FD",d];a(d,f);return}}f()};K.addWithCredentials=true;return K.before(function(a,b){var d,e,f;e=B(a.url);if(!e||e.origin===k){return b()}if(!C[e.origin]){if(e){x("no slave matching: '"+e.origin+"'")}return b()}x("proxying request to slave: '"+e.origin+"'");if(a.async===false){I("sync not supported");return b()}d=o(e.origin,C[e.origin]);f=h(d);f.on("response",function(a){b(a);return f.close()});a.xhr.addEventListener("abort",function(){return f.emit("abort")});if(f.ready){c(a,f)}else{f.once("ready",function(){return c(a,f)})}})};z=null;f=function(a){var b,c;if(z===null){z={};s()}for(b in a){c=a[b];x("adding master: "+b);z[b]=c}};s=function(){v(function(a,b){var c,d,e,f;if(a==="null"){a="*"}e=null;for(c in z){f=z[c];try{d=H(c);if(d.test(a)){e=H(f);break}}catch(g){}}if(!e){I("blocked request from: '"+a+"'");return}b.once("request",function(a){var c,d,f,g,h,i,j,k,l,m,n;x("request: "+a.method+" "+a.url);i=B(a.url);if(!(i&&e.test(i.path))){I("blocked request to path: '"+i.path+"' by regex: "+e);b.close();return}k=new XMLHttpRequest;k.open(a.method,a.url);k.addEventListener("*",function(a){return b.emit("xhr-event",a.type,G(a))});if(k.upload){k.upload.addEventListener("*",function(a){return b.emit("xhr-upload-event",a.type,G(a))})}b.once("abort",function(){return k.abort()});k.onreadystatechange=function(){var a;if(k.readyState!==4){return}a={status:k.status,statusText:k.statusText,data:k.response,headers:K.headers(k.getAllResponseHeaders())};try{a.text=k.responseText}catch(c){}return b.emit("response",a)};if(a.withCredentials){a.headers["XDomain-Cookie"]=a.credentials}if(a.timeout){k.timeout=a.timeout}if(a.type){k.responseType=a.type}n=a.headers;for(h in n){j=n[h];k.setRequestHeader(h,j)}if(a.body instanceof Array&&a.body[0]==="XD_FD"){g=new K.FormData;f=a.body[1];for(l=0,m=f.length;l<m;l++){c=f[l];if(c[0]==="XD_BLOB"&&c.length===4){d=new Blob([c[2]],{type:c[3]});c=c[1];c[1]=d}g.append.apply(g,c)}a.body=g}k.send(a.body||null)});x("slave listening for requests on socket: "+b.id)});if(a===a.parent){return I("slaves must be in an iframe")}else{return a.parent.postMessage("XDPING_"+d,"*")}};A=function(b){if(l.addEventListener){return a.addEventListener("message",b)}else{return a.attachEvent("onmessage",b)}};e="XD_CHECK";q=null;E={};u=true;F=function(){return A(function(a){var c,e,f,g;c=a.data;if(typeof c==="string"){if(/^XDPING(_(V\d+))?$/.test(c)&&RegExp.$2!==d){return I("your master is not compatible with your slave, check your xdomain.js version")}else if(/^xdomain-/.test(c)){c=c.split(",")}else if(u){try{c=JSON.parse(c)}catch(h){return}}}if(!(c instanceof Array)){return}f=c.shift();if(!/^xdomain-/.test(f)){return}g=E[f];if(g===null){return}if(g===b){if(!q){return}g=j(f,a.source);q(a.origin,g)}e=typeof c[1]==="string"?": '"+c[1]+"'":"";x("receive socket: "+f+": '"+c[0]+"'"+e);g.fire.apply(g,c)})};j=function(a,b){var d,f,g,h,i,j,k=this;i=false;j=E[a]=K.EventEmitter(true);j.id=a;j.once("close",function(){j.destroy();return j.close()});h=[];j.emit=function(){var b,c;b=D(arguments);c=typeof b[1]==="string"?": '"+b[1]+"'":"";x("send socket: "+a+": "+b[0]+c);b.unshift(a);if(i){g(b)}else{h.push(b)}};g=function(a){if(u){a=JSON.stringify(a)}b.postMessage(a,"*")};j.close=function(){j.emit("close");x("close socket: "+a);E[a]=null};j.once(e,function(b){u=typeof b==="string";i=j.ready=true;j.emit("ready");x("ready socket: "+a+" (emit #"+h.length+" pending)");while(h.length){g(h.shift())}});f=0;d=function(){b.postMessage([a,e,{}],"*");if(i){return}if(f++===J.timeout/c){I("Timeout waiting on iframe socket")}else{setTimeout(d,c)}};setTimeout(d);x("new socket: "+a);return j};h=function(a){var b;b=j(p(),a);return b};v=function(a){q=a};"use strict";K=(this.exports||this).xhook;J=function(a){if(!a){return}if(a.masters){f(a.masters)}if(a.slaves){g(a.slaves)}};J.masters=f;J.slaves=g;J.debug=false;J.timeout=15e3;c=100;l=a.document;w=a.location;k=J.origin=w.protocol+"//"+w.host;p=function(){return"xdomain-"+Math.round(Math.random()*Math.pow(2,32)).toString(16)};D=function(a,b){return Array.prototype.slice.call(a,b)};i=a.console||{};y=function(a){return function(b){b="xdomain ("+k+"): "+b;if(a in J){J[a](b)}if(a==="log"&&!J.debug){return}if(a in i){i[a](b)}else if(a==="warn"){alert(b)}}};x=y("log");I=y("warn");N=["postMessage","JSON"];for(L=0,M=N.length;L<M;L++){m=N[L];if(!a[m]){I("requires '"+m+"' and this browser does not support it");return}}t=function(b,c){if(!(c in a)){return false}return b instanceof a[c]};d="V1";B=J.parseUrl=function(a){if(/^((https?:)?\/\/[^\/\?]+)(\/.*)?/.test(a)){return{origin:(RegExp.$2?"":w.protocol)+RegExp.$1,path:RegExp.$3}}else{x("failed to parse absolute url: "+a);return null}};H=function(a){var b;if(a instanceof RegExp){return a}b=a.toString().replace(/\W/g,function(a){return"\\"+a}).replace(/\\\*/g,".*");return new RegExp("^"+b+"$")};G=function(a){var b,c,d,e;b={};for(c in a){if(c==="returnValue"){continue}d=a[c];if((e=typeof d)!=="function"&&e!=="object"){b[c]=d}}return b};(function(){var b,c,d,e,h,i,j,k,m,n,o;b={debug:function(a){if(typeof a!=="string"){return}return J.debug=a!=="false"},slave:function(a){var b,c;if(!a){return}b=B(a);if(!b){return}c={};c[b.origin]=b.path;return g(c)},master:function(a){var b,c;if(!a){return}if(a==="*"){c={origin:"*",path:"*"}}else{c=B(a)}if(!c){return}b={};b[c.origin]=c.path.replace(/^\//,"")?c.path:"*";return f(b)}};if(a.DCO_XDOMAIN)b.slave(a.DCO_XDOMAIN);n=l.getElementsByTagName("script");for(i=0,k=n.length;i<k;i++){h=n[i];if(/xdomain/.test(h.src)){o=["","data-"];for(j=0,m=o.length;j<m;j++){e=o[j];for(d in b){c=b[d];c(h.getAttribute(e+d))}}}}})();F();if(typeof this.define==="function"&&this.define.amd){define("xdomain",["xhook"],function(a){K=a;return J})}else{(this.exports||this).xdomain=J}}).call(this,window);